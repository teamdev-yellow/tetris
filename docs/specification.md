# テトリス仕様書

## 1. **基本機能**

**1.1 プレイフィールド**:

- 横10マス、縦22マスのフィールドを用意する。
- 縦21, 22は表示されない
- ブロック（テトリミノ）がフィールドの上部(21-22マス目）から降下する。

**1.2 テトリミノの生成**:

- 7種類のテトリミノ（I、O、T、L、J、S、Z）をランダムに生成。
    - テトリミノの形を色は下記を参考にする
    
    ![image.png](https://img.atwiki.jp/tetrismaps/attach/75/379/2020y10m27d_085257857.jpg)
    
- テトリミノの初期状態
    - 向き：上記の画像と同じ
    

**1.3 操作と回転:**

- **左右移動とオートリピート**:
    - ボタンを1回押すと1ブロック移動。
    - 長押しした場合、0.3秒後にオートリピートが開始され、端から端まで0.5秒で移動する（　横は10ブロックなので、1ブロック0.05秒）。
- **左右回転:**
    - 回転軸:
        - Iミノは4×4グリッド内で定義されており、回転軸が左右にずれた位置に設定される
        - Oミノは回転しない
        - Iミノ以外は3×3グリッド内で定義されており、回転軸はブロックの真ん中
        
        参考：[https://tetrisch.github.io/main/srs.html](https://tetrisch.github.io/main/srs.html)の「回転」セクション
        
- **ソフトドロップ:**
    - ソフトドロップは押してる間落下速度が現在の自然落下速度の20倍になる。
- **ハードドロップ:**
    - スペースキーを押すことで、0.0001秒でテトリミノを高速落下させる
    

**1.4 テトリス衝突判定:**

- **基本的な衝突判定のルール**
    - テトリミノが左右移動・回転する際、次の位置にすでに別のブロックや壁が存在するかどうかを確認する。
    - テトリミノが下方向に移動しブロックや床がある場合、その位置で停止し、次のブロックが生成される。
    - 衝突判定は、各テトリミノの現在の位置を基準に、移動や回転後の座標を調べて行われる。
    - ブロックの衝突が検知された場合、その動作は無効となり、ブロックは移動や回転を行わない。
    

**1.5 ライン消去**:

- 横一列すべて埋まるとその列が消え、消えたライン分だけ上から新しい空白が出現。

**1.6 ゲームオーバー条件**:

- ブロックがフィールドの上端に達した場合(21段目に積み上がった場合)、ゲームオーバーとなる。

<br>

## 2. レベル

**2-1. レベルの上昇条件**

- 各レベルごとに一定数のラインを消去することで、次のレベルに進む。
- 10ライン消去ごとに次のレベルに移行。
- レベル0からスタートし、最高レベルは15とする

**2-2. レベルに基づく落下速度**

- レベル1では落下速度を1秒とする
- 各レベルにおけるブロックの落下速度は、落下時間 = 初期時間 × (0.8 - ((レベル - 1) × 0.007)) ^ (レベル - 1)とする

<br>

## 3. スコア

3-1. **スコア加算の基本ルール**

- **ライン消去による基本スコア**：1度に消去するライン数に応じてスコアが加算される。
    - 1ライン消去: 100ポイント
    - 2ライン消去: 300ポイント
    - 3ライン消去: 500ポイント
    - 4ライン消去（テトリス）: 800ポイント
- **レベルによるスコア倍率**：ゲームのレベルが上がるごとに、各アクションに対するスコアは倍率がかかり、高い得点が得られる。
    - スコア = 基本スコア × 現在のレベル
    

3-2. **ボーナススコア**

- **バック・トゥ・バック**：テトリスを連続して行った場合、通常のスコアに対して1.5倍の得点が与えられる。
- **コンボ**：連続してラインを消去するたびに、コンボとして追加スコアが獲得されます。
    - **1回目のコンボ**: 50ポイント
    - **2回目のコンボ**: 100ポイント
    - **3回目のコンボ**: 150ポイント
    - **4回目以降**: 50ポイントずつ加算される（例: 200, 250, 300...）

<br>

## 4. **追加機能（時間があれば）**


- **ホールド機能**:
    - ブロックを一時的に保留する機能を実装し、後でそのブロックを使用できる。
- **ゴーストブロック表示**:
    - ブロックがどこに落ちるかを予測するために、ゴーストブロックを表示する。
- **次のブロック表示**:
    - 次に登場するブロックを画面に表示し、プレイヤーが次の動作を予測できるようにする。
- **スーパーローテーション：**
    - ブロックはスーパーローテーションシステム（SRS）に従い、壁や他のブロックに衝突しないように回転が調整される。
    - 回転時に5パターンの位置補正を行い、最も小さいインデックスの位置に移動する。
        - 参考：[https://tetrisch.github.io/main/srs.html](https://tetrisch.github.io/main/srs.html)
    - 回転入れ（狭い場所に回転を駆使してブロックを入れる）や、回転を利用してブロックを「登らせる」ことが可能。
        - 参考：[http://waka.nu/tetris/spin/index.html](http://waka.nu/tetris/spin/index.html)
        
<br>

## 5. **UIとユーザーインターフェース**

- **スコア、レベル、次のブロック表示**:
    - 現在のスコア、レベル、次に登場するブロックを画面上に表示。
- **ホームボタン**:
    - ホームに戻る

- **操作方法**: 
    - キーボード操作（矢印キーとスペースバー）
